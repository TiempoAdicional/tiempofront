<div class="comentarios-container">
  <!-- üÜï Informaci√≥n del         <mat-form-field appearance="outline" class="contenido-field">
          <mat-label>Tu comentario</mat-label>
          <textarea matInput formControlName="contenido" rows="4" 
                   placeholder="Escribe tu comentario aqu√≠..." 
                   [attr.maxlength]="1000"></textarea>
          <mat-hint align="end">
            {{ comentarioForm.get('contenido')?.value?.length || 0 }}/1000
          </mat-hint>
          <mat-error *ngIf="comentarioForm.get('contenido')?.errors?.['required']">
            El comentario es requerido
          </mat-error>
          <mat-error *ngIf="comentarioForm.get('contenido')?.errors?.['minlength']">
            El comentario debe tener al menos 10 caracteres
          </mat-error>
          <mat-error *ngIf="comentarioForm.get('contenido')?.errors?.['maxlength']">
            El comentario no puede superar los 1000 caracteres
          </mat-error>
        </mat-form-field>ios -->
  <div class="comentarios-limite-info" *ngIf="!cargandoComentarios" @fadeIn>
    <mat-card class="limite-card">
      <mat-card-content>
        <div class="limite-content">
          <div class="limite-stats">
            <mat-icon [class.limite-warning]="infoComentarios.restantes <= 1"
              [class.limite-ok]="infoComentarios.restantes > 1">
              {{ infoComentarios.restantes > 1 ? 'comment' : 'warning' }}
            </mat-icon>
            <div class="limite-text">
              <strong>{{ infoComentarios.totalComentarios }}/{{ infoComentarios.limite }}</strong>
              <span class="limite-description">comentarios</span>
            </div>
          </div>

          <div class="limite-progress">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="porcentajeLimite"></div>
            </div>
            <span class="limite-mensaje" [class.limite-completo]="!infoComentarios.puedeComentary">
              {{ mensajeLimite }}
            </span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Formulario para nuevo comentario -->
  <mat-card class="comentario-form-card" *ngIf="puedeComentary" @slideInUp>
    <mat-card-header>
      <mat-card-title>
        <mat-icon>comment</mat-icon>
        Deja tu comentario
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="comentarioForm" (ngSubmit)="enviarComentario()">
        <mat-form-field appearance="outline" class="autor-field">
          <mat-label>Tu nombre</mat-label>
          <input matInput formControlName="autor" placeholder="Ingresa tu nombre">
          <mat-icon matSuffix>person</mat-icon>
          <mat-error *ngIf="comentarioForm.get('autor')?.errors?.['required']">
            El nombre es requerido
          </mat-error>
          <mat-error *ngIf="comentarioForm.get('autor')?.errors?.['minlength']">
            El nombre debe tener al menos 2 caracteres
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="email-field">
          <mat-label>Tu email (opcional)</mat-label>
          <input matInput formControlName="email" type="email" placeholder="tu@email.com">
          <mat-icon matSuffix>email</mat-icon>
          <mat-error *ngIf="comentarioForm.get('email')?.errors?.['email']">
            Por favor ingresa un email v√°lido
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="mensaje-field">
          <mat-label>Tu comentario</mat-label>
          <textarea matInput formControlName="contenido" rows="4" placeholder="Escribe tu comentario aqu√≠..."
            [attr.maxlength]="1000"></textarea>
          <mat-hint align="end">
            {{ comentarioForm.get('contenido')?.value?.length || 0 }}/1000
          </mat-hint>
          <mat-error *ngIf="comentarioForm.get('contenido')?.errors?.['required']">
            El comentario es requerido
          </mat-error>
          <mat-error *ngIf="comentarioForm.get('contenido')?.errors?.['minlength']">
            El comentario debe tener al menos 10 caracteres
          </mat-error>
          <mat-error *ngIf="comentarioForm.get('contenido')?.errors?.['maxlength']">
            El comentario no puede superar los 1000 caracteres
          </mat-error>
        </mat-form-field>

        <div class="form-actions">
          <button mat-raised-button color="primary" type="submit"
            [disabled]="comentarioForm.invalid || enviando || !puedeComentary" class="submit-button">
            <mat-icon *ngIf="!enviando">send</mat-icon>
            <mat-progress-spinner *ngIf="enviando" diameter="20" mode="indeterminate"></mat-progress-spinner>
            {{ enviando ? 'Enviando...' : 'Enviar comentario' }}
          </button>
          <p class="form-note">
            <mat-icon>info</mat-icon>
            Los comentarios son revisados antes de ser publicados
          </p>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Mensaje cuando no se puede comentar -->
  <mat-card class="comentario-disabled-card" *ngIf="!puedeComentary && permitirComentarios" @slideInUp>
    <mat-card-content>
      <div class="disabled-content">
        <mat-icon class="disabled-icon">block</mat-icon>
        <h4>Comentarios llenos</h4>
        <p>Esta noticia ya tiene el m√°ximo de comentarios permitidos ({{ infoComentarios.limite }})</p>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Lista de comentarios -->
  <div class="comentarios-lista" @fadeIn>
    <div class="comentarios-header" *ngIf="comentarios.length > 0">
      <h3 class="comentarios-titulo">
        <mat-icon>forum</mat-icon>
        Comentarios
        <mat-chip class="comentarios-count" [matBadge]="infoComentarios.comentariosAprobados"
          [matBadgeHidden]="infoComentarios.comentariosAprobados === 0">
          {{ infoComentarios.totalComentarios }}
        </mat-chip>
      </h3>
      <mat-divider></mat-divider>
    </div>

    <!-- Estado de carga -->
    <div class="comentarios-loading" *ngIf="cargandoComentarios" @pulse>
      <mat-progress-spinner diameter="40" mode="indeterminate"></mat-progress-spinner>
      <p>Cargando comentarios...</p>
    </div>

    <!-- Estado vac√≠o -->
    <div class="no-comentarios" *ngIf="!cargandoComentarios && comentarios.length === 0" @fadeIn>
      <mat-icon class="empty-icon">comment_bank</mat-icon>
      <h4>A√∫n no hay comentarios</h4>
      <p>¬°S√© el primero en compartir tu opini√≥n!</p>
    </div>

    <!-- Tarjetas de comentarios -->
    <div class="comentarios-grid" *ngIf="!cargandoComentarios && comentarios.length > 0">
      <mat-card class="comentario-card"
        *ngFor="let comentario of comentarios; let i = index; trackBy: trackByComentario"
        [class.comentario-pendiente]="!comentario.aprobado" [class.comentario-aprobado]="comentario.aprobado"
        @slideInUp>
        <mat-card-header>
          <div mat-card-avatar class="comentario-avatar">
            <mat-icon>person</mat-icon>
          </div>
          <div class="comentario-header-content">
            <mat-card-title class="comentario-autor">
              {{ comentario.autor || comentario.autorNombre || 'An√≥nimo' }}
            </mat-card-title>
            <mat-card-subtitle class="comentario-metadata">
              <span class="comentario-fecha">
                <mat-icon class="metadata-icon">schedule</mat-icon>
                {{ formatearFecha(getFechaComentario(comentario)) }}
              </span>
              <mat-chip class="comentario-estado" [class]="getClaseEstado(comentario)" selected>
                <mat-icon>{{ getIconoEstado(comentario) }}</mat-icon>
                {{ getTextoEstado(comentario) }}
              </mat-chip>
            </mat-card-subtitle>
          </div>

          <!-- Men√∫ de acciones de admin -->
          <div class="comentario-actions" *ngIf="esAdmin">
            <button mat-icon-button [matMenuTriggerFor]="adminMenu" aria-label="Acciones de administrador">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #adminMenu="matMenu">
              <!-- Aprobar comentario del backend -->
              <button mat-menu-item (click)="aprobar(comentario)" *ngIf="!comentario.aprobado">
                <mat-icon color="primary">check_circle</mat-icon>
                <span>Aprobar</span>
              </button>
              <!-- Eliminar comentario del backend -->
              <button mat-menu-item (click)="eliminar(comentario)" class="delete-action">
                <mat-icon color="warn">delete</mat-icon>
                <span>Eliminar</span>
              </button>
            </mat-menu>
          </div>
        </mat-card-header>

        <mat-card-content>
          <p class="comentario-mensaje">
            <mat-icon *ngIf="comentario.aprobado" color="primary"
              style="vertical-align: middle;">check_circle</mat-icon>
            {{ comentario.mensaje }}
          </p>
        </mat-card-content>

        <!-- Acciones r√°pidas de admin para m√≥vil -->
        <mat-card-actions *ngIf="esAdmin" class="mobile-admin-actions">
          <button mat-button color="primary" (click)="aprobar(comentario)" *ngIf="!comentario.aprobado"
            class="approve-btn">
            <mat-icon>check</mat-icon>
            Aprobar
          </button>
          <button mat-button color="warn" (click)="eliminar(comentario)" class="delete-btn">
            <mat-icon>delete</mat-icon>
            Eliminar
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>
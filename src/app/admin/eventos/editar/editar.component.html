<div class="crear-evento-container">
  <!-- Header con navegaci√≥n mejorado -->
  <div class="header-section">
    <button mat-fab color="primary" class="back-button" (click)="volverAlDashboard()" matTooltip="Volver al Dashboard">
      <mat-icon>arrow_back</mat-icon>
    </button>

    <div class="header-content">
      <h1 class="page-title">
        <mat-icon class="title-icon">edit</mat-icon>
        Editar Evento Deportivo
      </h1>
      <p class="page-subtitle">Actualice la informaci√≥n del evento deportivo</p>
    </div>
  </div>

  <!-- Indicador de carga -->
  <div class="cargando" *ngIf="cargando">
    <mat-icon class="icono-cargando spin">autorenew</mat-icon>
    <span>Cargando evento...</span>
  </div>

  <!-- Selecci√≥n de evento -->
  <section class="seleccion-eventos" *ngIf="!eventoId && !cargando">
    <h2 class="titulo-edicion">Selecciona un evento para editar</h2>
    <p class="subtitulo-seleccion">
      Se muestran solo los eventos que has creado. Todos son editables.
    </p>

    <div *ngIf="eventos.length === 0" class="sin-eventos">
      <mat-icon>event_busy</mat-icon>
      <span>No tienes eventos creados a√∫n.</span>
    </div>

    <div class="lista-eventos" *ngIf="eventos.length > 0">
      <mat-card class="tarjeta-evento evento-editable" *ngFor="let evento of eventos">

        <div class="imagen-container">
          <img mat-card-image [src]="evento.imagenEvento || 'assets/default-event.jpg'"
            alt="Imagen del evento {{ evento.nombre }}" class="imagen-evento" />
          <div class="overlay-estado">
            <div class="badge-estado editable">
              <mat-icon>edit</mat-icon>
            </div>
          </div>
        </div>

        <mat-card-content class="contenido-evento">
          <h3 class="titulo-evento">{{ evento.nombre }}</h3>
          <div class="detalles-evento">
            <div class="detalle">
              <mat-icon>event</mat-icon>
              <span>{{ evento.fecha | date:'dd/MM/yyyy' }}</span>
            </div>
            <div class="detalle">
              <mat-icon>location_on</mat-icon>
              <span>{{ evento.lugar }}</span>
            </div>
          </div>
          <p class="descripcion-evento">{{ evento.descripcion }}</p>

          <div class="estado-permiso">
            <span class="badge-permiso editable">
              <mat-icon>check_circle</mat-icon>
              Puedes editar
            </span>
          </div>
        </mat-card-content>

        <mat-card-actions class="acciones-evento">
          <button mat-raised-button color="primary" (click)="seleccionarEvento(evento.id)" class="boton-accion">
            <mat-icon>edit</mat-icon>
            Editar evento
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </section>

  <!-- Formulario principal -->
  <mat-card class="form-card" elevation="2" *ngIf="form && !cargando">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>edit</mat-icon>
        Informaci√≥n del Evento
      </mat-card-title>
      <mat-card-subtitle>
        Todos los campos marcados con * son obligatorios
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="actualizarEvento()" class="event-form">

        <!-- Secci√≥n: Informaci√≥n B√°sica -->
        <div class="form-section">
          <h3 class="section-title">
            <mat-icon>info</mat-icon>
            Informaci√≥n B√°sica
          </h3>

          <div class="form-grid">
            <!-- Nombre del evento -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Nombre del Evento *</mat-label>
              <input matInput formControlName="nombre" placeholder="Ej. Final Liga BetPlay 2024" maxlength="100">
              <mat-icon matSuffix>event</mat-icon>
              <mat-hint align="end">{{form.get('nombre')?.value?.length || 0}}/100</mat-hint>
              <mat-error *ngIf="form.get('nombre')?.invalid && form.get('nombre')?.touched">
                El nombre del evento es obligatorio
              </mat-error>
            </mat-form-field>

            <!-- Tipo de evento -->
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Tipo de Evento *</mat-label>
              <mat-select formControlName="tipoEvento">
                <mat-option value="partido">‚öΩ Partido</mat-option>
                <mat-option value="torneo">üèÜ Torneo</mat-option>
                <mat-option value="final">üëë Final</mat-option>
                <mat-option value="semifinal">ü•à Semifinal</mat-option>
                <mat-option value="cuartos">ü•â Cuartos de Final</mat-option>
                <mat-option value="amistoso">ü§ù Partido Amistoso</mat-option>
                <mat-option value="clasificatorio">üìã Clasificatorio</mat-option>
                <mat-option value="copa">üèÖ Copa</mat-option>
              </mat-select>
              <mat-icon matSuffix>category</mat-icon>
            </mat-form-field>

            <!-- Importancia -->
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Importancia</mat-label>
              <mat-select formControlName="importancia">
                <mat-option value="baja">üü¢ Baja</mat-option>
                <mat-option value="media">üü° Media</mat-option>
                <mat-option value="alta">üü† Alta</mat-option>
                <mat-option value="critica">üî¥ Cr√≠tica</mat-option>
              </mat-select>
              <mat-icon matSuffix>priority_high</mat-icon>
            </mat-form-field>
          </div>

          <!-- Descripci√≥n -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Descripci√≥n del Evento *</mat-label>
            <textarea matInput formControlName="descripcion" rows="4"
              placeholder="Describe el evento, equipos participantes, contexto, etc." maxlength="500"></textarea>
            <mat-icon matSuffix>description</mat-icon>
            <mat-hint align="end">{{form.get('descripcion')?.value?.length || 0}}/500</mat-hint>
            <mat-error *ngIf="form.get('descripcion')?.invalid && form.get('descripcion')?.touched">
              La descripci√≥n es obligatoria
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Secci√≥n: Fecha y Ubicaci√≥n -->
        <div class="form-section">
          <h3 class="section-title">
            <mat-icon>schedule</mat-icon>
            Fecha y Ubicaci√≥n
          </h3>

          <div class="form-grid">
            <!-- Fecha -->
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Fecha del Evento *</mat-label>
              <input matInput [matDatepicker]="datePicker" formControlName="fecha" placeholder="Seleccionar fecha">
              <mat-datepicker-toggle matSuffix [for]="datePicker"></mat-datepicker-toggle>
              <mat-datepicker #datePicker></mat-datepicker>
              <mat-error *ngIf="form.get('fecha')?.invalid && form.get('fecha')?.touched">
                La fecha es obligatoria
              </mat-error>
            </mat-form-field>

            <!-- Hora -->
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Hora del Evento</mat-label>
              <input matInput type="time" formControlName="hora" placeholder="00:00">
              <mat-icon matSuffix>access_time</mat-icon>
            </mat-form-field>

            <!-- Lugar/Estadio -->
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Estadio/Lugar *</mat-label>
              <input matInput formControlName="lugar" placeholder="Ej. Estadio El Camp√≠n" maxlength="100">
              <mat-icon matSuffix>stadium</mat-icon>
              <mat-error *ngIf="form.get('lugar')?.invalid && form.get('lugar')?.touched">
                El lugar es obligatorio
              </mat-error>
            </mat-form-field>

            <!-- Ciudad -->
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Ciudad</mat-label>
              <input matInput formControlName="ciudad" placeholder="Ej. Bogot√°" maxlength="50">
              <mat-icon matSuffix>location_city</mat-icon>
            </mat-form-field>
          </div>
        </div>

        <!-- Secci√≥n: Equipos (si es partido) -->
        <div class="form-section"
          *ngIf="form.get('tipoEvento')?.value === 'partido' || form.get('tipoEvento')?.value === 'final' || form.get('tipoEvento')?.value === 'semifinal'">
          <h3 class="section-title">
            <mat-icon>groups</mat-icon>
            Equipos Participantes
          </h3>

          <div class="form-grid">
            <!-- Equipo Local -->
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Equipo Local</mat-label>
              <input matInput formControlName="equipoLocal" placeholder="Ej. Atl√©tico Nacional" maxlength="50">
              <mat-icon matSuffix>home</mat-icon>
            </mat-form-field>

            <!-- Equipo Visitante -->
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Equipo Visitante</mat-label>
              <input matInput formControlName="equipoVisitante" placeholder="Ej. Millonarios FC" maxlength="50">
              <mat-icon matSuffix>flight</mat-icon>
            </mat-form-field>
          </div>
        </div>

        <!-- Secci√≥n: Organizaci√≥n -->
        <div class="form-section">
          <h3 class="section-title">
            <mat-icon>business</mat-icon>
            Organizaci√≥n y Categorizaci√≥n
          </h3>

          <div class="form-grid">
            <!-- Secci√≥n -->
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Secci√≥n del Peri√≥dico</mat-label>
              <mat-select formControlName="seccionId">
                <mat-option value="">Sin secci√≥n espec√≠fica</mat-option>
                <mat-option *ngFor="let seccion of secciones" [value]="seccion.id">
                  {{seccion.titulo}}
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>folder</mat-icon>
              <mat-hint>Opcional: Asigne a una secci√≥n del peri√≥dico</mat-hint>
            </mat-form-field>

            <!-- Competici√≥n -->
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Competici√≥n</mat-label>
              <mat-select formControlName="competicion">
                <mat-option value="liga-betplay">Liga BetPlay</mat-option>
                <mat-option value="copa-colombia">Copa Colombia</mat-option>
                <mat-option value="libertadores">Copa Libertadores</mat-option>
                <mat-option value="sudamericana">Copa Sudamericana</mat-option>
                <mat-option value="eliminatorias">Eliminatorias</mat-option>
                <mat-option value="amistoso">Partido Amistoso</mat-option>
                <mat-option value="otro">Otro</mat-option>
              </mat-select>
              <mat-icon matSuffix>emoji_events</mat-icon>
            </mat-form-field>

            <!-- Estado del evento -->
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Estado</mat-label>
              <mat-select formControlName="estado">
                <mat-option value="programado">üìÖ Programado</mat-option>
                <mat-option value="en-vivo">üî¥ En Vivo</mat-option>
                <mat-option value="finalizado">‚úÖ Finalizado</mat-option>
                <mat-option value="suspendido">‚è∏Ô∏è Suspendido</mat-option>
                <mat-option value="cancelado">‚ùå Cancelado</mat-option>
              </mat-select>
              <mat-icon matSuffix>info</mat-icon>
            </mat-form-field>

            <!-- Precio estimado -->
            <mat-form-field appearance="outline" class="half-width">
              <mat-label>Precio Estimado (COP)</mat-label>
              <input matInput type="number" formControlName="precioEstimado" placeholder="0" min="0">
              <span matPrefix>$ </span>
              <mat-icon matSuffix>attach_money</mat-icon>
              <mat-hint>Precio aproximado de entrada</mat-hint>
            </mat-form-field>
          </div>
        </div>

        <!-- Secci√≥n: Multimedia -->
        <div class="form-section">
          <h3 class="section-title">
            <mat-icon>photo_library</mat-icon>
            Multimedia
          </h3>

          <!-- Imagen del evento -->
          <div class="file-upload-section">
            <mat-label class="upload-label">
              <mat-icon>image</mat-icon>
              Imagen del Evento
            </mat-label>
            <div class="file-upload-container">
              <input type="file" #fileInput (change)="onFileSelected($event)" accept="image/*" style="display: none;">
              <button mat-stroked-button color="primary" type="button" (click)="fileInput.click()"
                class="upload-button">
                <mat-icon>cloud_upload</mat-icon>
                Seleccionar Imagen
              </button>
              <span class="file-info" *ngIf="imagenSeleccionada">
                {{imagenSeleccionada.name}}
              </span>
            </div>
          </div>

          <!-- Vista previa de imagen -->
          <div *ngIf="imagenUrl || imagenPreview" class="image-preview">
            <mat-label>Vista Previa:</mat-label>
            <img [src]="imagenUrl || imagenPreview" alt="Vista previa del evento" class="preview-image">
          </div>

          <!-- URL del video -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>URL de Video (Opcional)</mat-label>
            <input matInput formControlName="videoUrl" placeholder="https://youtube.com/watch?v=..." type="url">
            <mat-icon matSuffix>videocam</mat-icon>
            <mat-hint>YouTube, Twitch, Facebook Live, etc.</mat-hint>
            <mat-error *ngIf="form.get('videoUrl')?.invalid && form.get('videoUrl')?.touched">
              Por favor ingrese una URL v√°lida
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Secci√≥n: Informaci√≥n Adicional -->
        <div class="form-section">
          <h3 class="section-title">
            <mat-icon>add_circle</mat-icon>
            Informaci√≥n Adicional
          </h3>

          <div class="form-grid">
            <!-- Tags -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Tags (separados por comas)</mat-label>
              <input matInput formControlName="tags" placeholder="f√∫tbol, liga, final, nacional, millonarios">
              <mat-icon matSuffix>tag</mat-icon>
              <mat-hint>Palabras clave para b√∫squedas</mat-hint>
            </mat-form-field>

            <!-- Notas adicionales -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Notas Adicionales</mat-label>
              <textarea matInput formControlName="notas" rows="3"
                placeholder="Informaci√≥n adicional, comentarios internos, etc." maxlength="300"></textarea>
              <mat-icon matSuffix>note</mat-icon>
              <mat-hint align="end">{{form.get('notas')?.value?.length || 0}}/300</mat-hint>
            </mat-form-field>
          </div>
        </div>

      </form>
    </mat-card-content>

    <!-- Botones de acci√≥n -->
    <mat-card-actions class="form-actions">
      <button mat-raised-button color="primary" type="submit" [disabled]="guardando || form.invalid"
        (click)="actualizarEvento()" class="action-button">
        <mat-icon>save</mat-icon>
        <span *ngIf="!guardando">Guardar Cambios</span>
        <span *ngIf="guardando">Guardando...</span>
      </button>

      <button mat-outlined-button color="accent" type="button" (click)="cancelarEdicion()" [disabled]="guardando"
        class="action-button">
        <mat-icon>refresh</mat-icon>
        Cancelar Edici√≥n
      </button>

      <button mat-outlined-button color="warn" type="button" (click)="volverAlDashboard()" [disabled]="guardando"
        class="action-button">
        <mat-icon>cancel</mat-icon>
        Volver
      </button>
    </mat-card-actions>
  </mat-card>
</div>
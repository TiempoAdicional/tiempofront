<!-- ===============================
     üè† DASHBOARD USUARIO TIPO ESPN
     =============================== -->
<div class="usuario-container">

  <!-- ===============================
       üéØ BANNER DE BIENVENIDA - USUARIOS NO REGISTRADOS
       =============================== -->
  <div class="welcome-banner" *ngIf="!estaAutenticado">
    <mat-card class="welcome-card">
      <mat-card-content>
        <div class="welcome-content">
          <div class="welcome-icon">
            <mat-icon>sports</mat-icon>
          </div>
          <div class="welcome-text">
            <h3>¬°Bienvenido a Tiempo Adicional!</h3>
            <p>Est√°s viendo <strong>contenido limitado</strong>. Reg√≠strate <strong>gratis</strong> para acceder a:</p>
            <ul class="benefits-list">
              <li><mat-icon>article</mat-icon> Todas las noticias deportivas</li>
              <li><mat-icon>event</mat-icon> Eventos y coberturas completas</li>
              <li><mat-icon>sports_soccer</mat-icon> Estad√≠sticas detalladas de partidos</li>
              <li><mat-icon>comment</mat-icon> Poder comentar y participar</li>
            </ul>
          </div>
          <div class="welcome-actions">
            <button mat-raised-button color="primary" (click)="irARegistro()" class="register-btn">
              <mat-icon>person_add</mat-icon>
              Registrarse Gratis
            </button>
            <button mat-stroked-button color="accent" (click)="irALogin()" class="login-btn">
              <mat-icon>login</mat-icon>
              Iniciar Sesi√≥n
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- ===============================
       üì∞ HERO CAROUSEL - NOTICIAS DESTACADAS
       =============================== -->
  <section class="hero-carousel" *ngIf="noticiaDestacadaActual" (mouseenter)="pausarCarousel()"
    (mouseleave)="reanudarCarousel()">

    <!-- Carousel Container -->
    <div class="carousel-container">
      <!-- Noticia Actual -->
      <div class="carousel-slide active">
        <div class="hero-content">
          <div class="hero-imagen">
            <img [src]="noticiaDestacadaActual.imagenUrl || '/assets/edit-tools.png'"
              [alt]="noticiaDestacadaActual.titulo" class="hero-img">
            <div class="hero-overlay"></div>
          </div>

          <div class="hero-info">
            <mat-chip class="seccion-chip">‚≠ê {{ noticiaDestacadaActual.seccion }}</mat-chip>
            <h1 class="hero-titulo">{{ noticiaDestacadaActual.titulo }}</h1>
            <p class="hero-resumen">{{ noticiaDestacadaActual.resumen }}</p>

            <div class="hero-meta">
              <span class="fecha">{{ noticiaDestacadaActual.fechaPublicacion | date:'dd MMM yyyy' }}</span>
              <span class="autor-destacado" *ngIf="noticiaDestacadaActual.autorNombre">
                <mat-icon>person</mat-icon>
                Por {{ noticiaDestacadaActual.autorNombre }}
              </span>
              <button mat-raised-button color="accent" (click)="verNoticia(noticiaDestacadaActual)"
                class="leer-mas-btn">
                <mat-icon>article</mat-icon>
                Leer Completa
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Controles del Carousel -->
    <div class="carousel-controls" *ngIf="noticiasDestacadas.length > 1">
      <!-- Bot√≥n Anterior -->
      <button mat-fab class="carousel-btn carousel-btn-prev" (click)="anteriorNoticia()"
        [attr.aria-label]="'Noticia anterior'">
        <mat-icon>chevron_left</mat-icon>
      </button>

      <!-- Bot√≥n Siguiente -->
      <button mat-fab class="carousel-btn carousel-btn-next" (click)="siguienteNoticia()"
        [attr.aria-label]="'Siguiente noticia'">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>

    <!-- Indicadores -->
    <div class="carousel-indicators" *ngIf="noticiasDestacadas.length > 1">
      <button *ngFor="let noticia of noticiasDestacadas; let i = index" class="indicator"
        [class.active]="i === indiceNoticiaActual" (click)="irANoticia(i)"
        [attr.aria-label]="'Ir a noticia ' + (i + 1)">
      </button>
    </div>

    <!-- Barra de Progreso -->
    <div class="progress-container" *ngIf="noticiasDestacadas.length > 1">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="progressValue"></div>
      </div>
      <span class="progress-text">
        {{ indiceNoticiaActual + 1 }} / {{ noticiasDestacadas.length }}
      </span>
    </div>
  </section>

  <!-- ===============================
        üéØ SECCIONES DIN√ÅMICAS DE CONTENIDO
       =============================== -->
  <div class="contenido-grid">

    <!-- ===============================
         üóûÔ∏è SECCIONES DE NOTICIAS DIN√ÅMICAS
         =============================== -->
    <section class="secciones-noticias">

      <!-- Loading de secciones -->
      <div class="loading-container" *ngIf="cargandoSecciones">
        <mat-progress-bar mode="indeterminate" color="accent"></mat-progress-bar>
        <p>Cargando secciones...</p>
      </div>

      <!-- Mostrar cada secci√≥n de noticias din√°micamente -->
      <div *ngFor="let seccionConContenido of obtenerSeccionesNoticias(); let last = last; trackBy: trackBySeccionId"
        class="seccion-dinamica">

        <div class="section-header">
          <h2 class="section-titulo">
            <mat-icon [style.color]="obtenerColorSeccion(seccionConContenido.seccion.tipo)">
              {{ obtenerIconoSeccion(seccionConContenido.seccion.tipo) }}
            </mat-icon>
            {{ seccionConContenido.seccion.titulo }}
          </h2>

          <!-- L√≠mite para no registrados -->
          <div class="limite-badge" *ngIf="mostrarLimites && noticiasLimitadas.length >= LIMITE_NOTICIAS">
            <mat-chip color="warn">
              <mat-icon matChipAvatar>visibility_off</mat-icon>
              M√°s disponibles registr√°ndote
            </mat-chip>
          </div>

          <!-- Bot√≥n ver todas -->
          <button mat-stroked-button color="accent" class="ver-todas-btn"
            (click)="navegarASeccion(seccionConContenido.seccion.id, seccionConContenido.seccion.tipo)">
            <mat-icon>open_in_new</mat-icon>
            Ver todas
          </button>
        </div>

        <!-- Grid de noticias para esta secci√≥n -->
        <div class="noticias-grid" *ngIf="!cargandoNoticias">
          <mat-card class="noticia-card" *ngFor="let noticia of seccionConContenido.contenido | slice:0:6"
            (click)="verNoticia(noticia)">
            <div class="card-image">
              <img [src]="noticia.imagen || '/assets/default-news.jpg'" [alt]="noticia.titulo">
            </div>
            <mat-card-header>
              <mat-chip class="seccion-mini"
                [style.background-color]="obtenerColorSeccion(seccionConContenido.seccion.tipo)"
                [style.color]="'white'">
                {{ seccionConContenido.seccion.titulo }}
              </mat-chip>
              <mat-card-title class="noticia-titulo">{{ noticia.titulo }}</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <p class="noticia-resumen">{{ noticia.descripcion }}</p>
              <div class="noticia-meta">
                <span class="fecha-mini">{{ noticia.fecha | date:'dd/MM' }}</span>
                <mat-icon class="read-icon">chevron_right</mat-icon>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Separador entre secciones -->
        <mat-divider class="seccion-divider" *ngIf="!last"></mat-divider>
      </div>

      <!-- Fallback: Secci√≥n tradicional si no hay secciones din√°micas -->
      <section id="noticias" class="noticias-section"
        *ngIf="obtenerSeccionesNoticias().length === 0 && !cargandoSecciones">
        <div class="section-header">
          <h2 class="section-titulo">
            <mat-icon>article</mat-icon>
            √öltimas Noticias
          </h2>

          <!-- L√≠mite para no registrados -->
          <div class="limite-badge" *ngIf="mostrarLimites && noticiasLimitadas.length >= LIMITE_NOTICIAS">
            <mat-chip color="warn">
              <mat-icon matChipAvatar>visibility_off</mat-icon>
              M√°s disponibles registr√°ndote
            </mat-chip>
          </div>
        </div>

        <!-- Loading de noticias -->
        <div class="loading-container" *ngIf="cargandoNoticias">
          <mat-progress-bar mode="indeterminate" color="accent"></mat-progress-bar>
          <p>Cargando noticias deportivas...</p>
        </div>

        <!-- Grid de noticias tradicional -->
        <div class="noticias-grid" *ngIf="!cargandoNoticias">
          <mat-card class="noticia-card" *ngFor="let noticia of noticiasLimitadas" [class.bloqueada]="noticia.bloqueada"
            (click)="verNoticia(noticia)">

            <div class="card-image">
              <img [src]="noticia.imagenUrl || '/assets/default-news.jpg'" [alt]="noticia.titulo">

              <!-- Overlay para contenido bloqueado -->
              <div class="block-overlay" *ngIf="noticia.bloqueada">
                <mat-icon class="lock-icon">lock</mat-icon>
                <span>Reg√≠strate para ver m√°s</span>
              </div>
            </div>

            <mat-card-header>
              <mat-chip class="seccion-mini">{{ noticia.seccion }}</mat-chip>
              <mat-card-title class="noticia-titulo">{{ noticia.titulo }}</mat-card-title>
            </mat-card-header>

            <mat-card-content>
              <p class="noticia-resumen">{{ noticia.resumen }}</p>
              <div class="noticia-meta">
                <span class="fecha-mini">{{ noticia.fechaPublicacion | date:'dd/MM' }}</span>
                <span class="autor-mini" *ngIf="noticia.autorNombre">Por {{ noticia.autorNombre }}</span>
                <mat-icon class="read-icon">chevron_right</mat-icon>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </section>

      <!-- Aviso de l√≠mite de noticias -->
      <div class="limite-aviso" *ngIf="mostrarAvisoLimiteNoticias">
        <mat-card class="aviso-card">
          <mat-card-content>
            <mat-icon class="aviso-icon">info</mat-icon>
            <h4>¬°Hay m√°s noticias disponibles!</h4>
            <p>Reg√≠strate gratis para ver todas las noticias deportivas sin l√≠mites.</p>
            <button mat-raised-button color="primary" (click)="irARegistro()">
              <mat-icon>person_add</mat-icon>
              Ver M√°s Noticias
            </button>
          </mat-card-content>
        </mat-card>
      </div>
    </section>

    <!-- COLUMNA DERECHA: EVENTOS Y PARTIDOS -->
    <aside id="eventos" class="eventos-sidebar">

      <!-- PR√ìXIMOS EVENTOS -->
      <section class="eventos-section">
        <div class="section-header">
          <h3 class="section-titulo">
            <mat-icon>event</mat-icon>
            Pr√≥ximos Eventos
          </h3>

          <!-- L√≠mite para no registrados -->
          <div class="limite-badge" *ngIf="mostrarLimites">
            <mat-chip color="warn" class="mini-chip">
              {{ eventosRestantes }} m√°s
            </mat-chip>
          </div>
        </div>

        <!-- Loading de eventos -->
        <div class="loading-mini" *ngIf="cargandoEventos">
          <mat-progress-bar mode="indeterminate" color="accent"></mat-progress-bar>
        </div>

        <!-- Lista de eventos -->
        <div class="eventos-lista" *ngIf="!cargandoEventos">
          <!-- Si no hay eventos -->
          <div *ngIf="eventosLimitados.length === 0" style="color:#c00;font-weight:bold;padding:12px 0;">
            No hay eventos para mostrar
          </div>
          <!-- Renderizar cards si hay eventos -->
          <mat-card class="evento-card" *ngFor="let evento of eventosLimitados" [class.bloqueado]="evento.bloqueado"
            (click)="verEvento(evento)">
            <mat-card-content>
              <div class="evento-fecha">
                <span class="dia">{{ evento.fecha | date:'dd' }}</span>
                <span class="mes">{{ evento.fecha | date:'MMM' }}</span>
              </div>
              <div class="evento-info">
                <h4 class="evento-titulo">{{ evento.titulo }}</h4>
                <p class="evento-competicion">{{ evento.competicion }}</p>
                <p class="evento-ubicacion">
                  <mat-icon>location_on</mat-icon>
                  {{ evento.ubicacion }}
                </p>
                <p class="evento-autor" *ngIf="evento.autorNombre">
                  <mat-icon>person</mat-icon>
                  Por {{ evento.autorNombre }}
                </p>
              </div>
              <!-- Icono de bloqueo -->
              <mat-icon class="evento-lock" *ngIf="evento.bloqueado">lock</mat-icon>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Aviso de l√≠mite de eventos -->
        <div class="limite-aviso" *ngIf="mostrarAvisoLimiteEventos">
          <mat-card class="aviso-card">
            <mat-card-content>
              <mat-icon class="aviso-icon">event_available</mat-icon>
              <h4>¬°Hay m√°s eventos disponibles!</h4>
              <p>Reg√≠strate gratis para ver todos los eventos deportivos.</p>
              <button mat-raised-button color="accent" (click)="irARegistro()">
                <mat-icon>person_add</mat-icon>
                Ver M√°s Eventos
              </button>
            </mat-card-content>
          </mat-card>
        </div>
      </section>

      <!-- PARTIDOS DE F√öTBOL -->
      <section class="partidos-section">
        <div class="section-header">
          <h3 class="section-titulo">
            <mat-icon>sports_soccer</mat-icon>
            Partidos de F√∫tbol
            <span class="contador">({{ partidosLimitados.length }})</span>
          </h3>
        </div>

        <!-- Loading de partidos -->
        <div *ngIf="cargandoPartidos" class="loading-container">
          <mat-progress-bar mode="indeterminate"></mat-progress-bar>
          <p>Cargando partidos...</p>
        </div>

        <!-- Lista de partidos reales -->
        <div class="partidos-lista" *ngIf="!cargandoPartidos && partidosLimitados.length > 0">
          <mat-card class="partido-card" [class.bloqueado]="partido.bloqueado"
            *ngFor="let partido of partidosLimitados; let i = index" (click)="verPartido(partido)">

            <mat-card-content>
              <div class="partido-equipos">
                <div class="equipo local">
                  <img [src]="partido.escudoEquipoLocal" [alt]="'Escudo ' + partido.nombreEquipoLocal"
                    class="escudo-equipo" (error)="onImagenEscudoError($event)">
                  <span class="equipo-nombre">{{ partido.nombreEquipoLocal }}</span>
                  <span class="equipo-score" *ngIf="partido.estado !== 'Por jugar'">
                    {{ partido.golesLocal }}
                  </span>
                </div>

                <div class="vs-container">
                  <span class="vs">VS</span>
                  <div class="partido-fecha">
                    {{ partido.fecha | date:'dd/MM HH:mm' }}
                  </div>
                  <div class="partido-estadio" *ngIf="partido.estadio">
                    <small>{{ partido.estadio }}</small>
                  </div>
                </div>

                <div class="equipo visitante">
                  <img [src]="partido.escudoEquipoVisitante" [alt]="'Escudo ' + partido.nombreEquipoVisitante"
                    class="escudo-equipo" (error)="onImagenEscudoError($event)">
                  <span class="equipo-nombre">{{ partido.nombreEquipoVisitante }}</span>
                  <span class="equipo-score" *ngIf="partido.estado !== 'Por jugar'">
                    {{ partido.golesVisitante }}
                  </span>
                </div>
              </div>

              <div class="partido-info">
                <mat-chip class="liga-chip">Liga Colombiana</mat-chip>
                <mat-chip class="estado-chip" [color]="partido.estado === 'En vivo' ? 'accent' : 'primary'">
                  {{ partido.estado }}
                  <span *ngIf="partido.minutoActual > 0 && partido.estado === 'En vivo'">
                    - {{ partido.minutoActual }}'
                  </span>
                </mat-chip>
              </div>

              <!-- Overlay para usuarios no registrados -->
              <div class="content-overlay" *ngIf="partido.bloqueado">
                <mat-icon>lock</mat-icon>
                <p>Reg√≠strate para ver m√°s detalles</p>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Mensaje si no hay partidos -->
        <div *ngIf="!cargandoPartidos && partidosLimitados.length === 0" class="no-content">
          <mat-icon>sports_soccer</mat-icon>
          <p>No hay partidos disponibles en este momento</p>
        </div>

        <!-- Banner espec√≠fico para ver m√°s partidos -->
        <div class="partidos-cta" *ngIf="!estaAutenticado && partidosLimitados.length > 0">
          <mat-card class="cta-card">
            <mat-card-content>
              <div class="cta-content">
                <mat-icon>sports_soccer</mat-icon>
                <div class="cta-text">
                  <p><strong>¬°Hay m√°s partidos disponibles!</strong></p>
                  <small>Estad√≠sticas completas, an√°lisis y cobertura en vivo</small>
                </div>
                <button mat-stroked-button color="accent" routerLink="/register" class="cta-btn">
                  <mat-icon>visibility</mat-icon>
                  Ver Todos
                </button>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </section>
    </aside>
  </div>


</div>
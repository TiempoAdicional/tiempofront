import{a as h}from"./chunk-W34LC3UO.js";import{a as b,b as d}from"./chunk-MCHRC6DH.js";import{a as c,ca as u,g as i,ha as l,k as o}from"./chunk-56OTQPDQ.js";var m=class n{constructor(t){this.http=t}API_URL=`${h.apiBaseUrl}/api/usuarios`;usuariosSubject=new o([]);cargandoSubject=new o(!1);estadisticasSubject=new o(null);usuarios$=this.usuariosSubject.asObservable();cargando$=this.cargandoSubject.asObservable();estadisticas$=this.estadisticasSubject.asObservable();listarTodos(){return this.cargandoSubject.next(!0),new i(t=>{this.http.get(this.API_URL).subscribe({next:r=>{this.usuariosSubject.next(r),this.calcularEstadisticas(r),this.cargandoSubject.next(!1),t.next(r),t.complete()},error:r=>{this.cargandoSubject.next(!1),t.error(r)}})})}buscarPorCorreo(t){this.cargandoSubject.next(!0);let r=new b().set("correo",t);return new i(e=>{this.http.get(`${this.API_URL}/buscar`,{params:r}).subscribe({next:s=>{this.cargandoSubject.next(!1),e.next(s),e.complete()},error:s=>{this.cargandoSubject.next(!1),e.error(s)}})})}obtenerPorId(t){return this.cargandoSubject.next(!0),new i(r=>{this.http.get(`${this.API_URL}/${t}`).subscribe({next:e=>{this.cargandoSubject.next(!1),r.next(e),r.complete()},error:e=>{this.cargandoSubject.next(!1),r.error(e)}})})}cambiarRol(t,r){this.cargandoSubject.next(!0);let e={rol:r};return new i(s=>{this.http.patch(`${this.API_URL}/${t}/rol`,e,{responseType:"text"}).subscribe({next:a=>{this.cargandoSubject.next(!1),this.actualizarUsuarioLocal(t,{rol:r}),s.next(a),s.complete()},error:a=>{this.cargandoSubject.next(!1),s.error(a)}})})}eliminarUsuario(t){return this.cargandoSubject.next(!0),new i(r=>{this.http.delete(`${this.API_URL}/${t}`).subscribe({next:e=>{this.cargandoSubject.next(!1),this.removerUsuarioLocal(t),r.next(e),r.complete()},error:e=>{this.cargandoSubject.next(!1),r.error(e)}})})}calcularEstadisticas(t){let r={totalUsuarios:t.length,editores:t.filter(e=>e.rol==="USUARIO").length,administradores:t.filter(e=>e.rol==="ADMIN").length,editoresJefe:t.filter(e=>e.rol==="EDITOR_JEFE").length,superAdmins:t.filter(e=>e.rol==="SUPER_ADMIN").length,usuariosActivos:t.filter(e=>e.activo).length,usuariosInactivos:t.filter(e=>!e.activo).length};this.estadisticasSubject.next(r)}obtenerEstadisticas(){return this.estadisticasSubject.value}actualizarUsuarioLocal(t,r){let e=this.usuariosSubject.value,s=e.findIndex(a=>a.id===t);if(s!==-1){let a=[...e];a[s]=c(c({},a[s]),r),this.usuariosSubject.next(a),this.calcularEstadisticas(a)}}removerUsuarioLocal(t){let e=this.usuariosSubject.value.filter(s=>s.id!==t);this.usuariosSubject.next(e),this.calcularEstadisticas(e)}obtenerUsuarios(){return this.usuariosSubject.value}limpiarCache(){this.usuariosSubject.next([]),this.estadisticasSubject.next(null),this.cargandoSubject.next(!1)}estaCargando(){return this.cargandoSubject.value}static obtenerColorRol(t){return{USUARIO:"#17a2b8",ADMIN:"#ffc107",EDITOR_JEFE:"#28a745",SUPER_ADMIN:"#dc3545"}[t]||"#6c757d"}static obtenerIconoRol(t){return{USUARIO:"edit",ADMIN:"admin_panel_settings",EDITOR_JEFE:"star",SUPER_ADMIN:"security"}[t]||"person"}static formatearFecha(t){try{return new Date(t).toLocaleDateString("es-CO",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return"Fecha inv\xE1lida"}}static \u0275fac=function(r){return new(r||n)(l(d))};static \u0275prov=u({token:n,factory:n.\u0275fac,providedIn:"root"})};export{m as a};

import{a as g}from"./chunk-MDURIX5C.js";import{a as E}from"./chunk-W34LC3UO.js";import{a as b,b as m}from"./chunk-MCHRC6DH.js";import{$ as n,H as i,Y as c,ca as h,ha as d,k as u,q as s,r as v,u as l}from"./chunk-56OTQPDQ.js";var f=class p{constructor(t,r){this.http=t;this.equipoService=r}apiUrl=`${E.apiBaseUrl}/api/eventos`;eventosSubject=new u([]);eventos$=this.eventosSubject.asObservable();listarTodos(){return this.http.get(this.apiUrl).pipe(n(t=>this.eventosSubject.next(t)),i(this.handleError("listarTodos",[])))}obtenerProximos(){return this.http.get(`${this.apiUrl}/proximos`).pipe(i(this.handleError("obtenerProximos",[])))}obtenerPorId(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(i(this.handleError(`obtenerPorId id=${t}`)))}crear(t){return this.http.post(`${this.apiUrl}/crear`,t).pipe(n(r=>this.actualizarCacheEvento(r)),c(r=>{let e=r.creador_id;return e?(console.log("\u{1F4CA} Actualizando estad\xEDsticas de evento para creador:",e),this.equipoService.actualizarEstadisticasEvento(e,"crear").pipe(l(()=>r),i(o=>(console.warn("\u26A0\uFE0F Error actualizando estad\xEDsticas de evento:",o),s(r))))):s(r)}),i(this.handleError("crear")))}actualizar(t,r){return this.http.put(`${this.apiUrl}/actualizar/${t}`,r).pipe(n(e=>this.actualizarCacheEvento(e)),i(this.handleError("actualizar")))}eliminar(t){return this.obtenerPorId(t).pipe(c(r=>{let e=r.creador_id;return this.http.delete(`${this.apiUrl}/${t}`).pipe(n(()=>this.eliminarDelCache(t)),c(o=>e?(console.log("\u{1F4CA} Actualizando estad\xEDsticas tras eliminar evento del creador:",e),this.equipoService.actualizarEstadisticasEvento(e,"eliminar").pipe(l(()=>o),i(a=>(console.warn("\u26A0\uFE0F Error actualizando estad\xEDsticas tras eliminar evento:",a),s(o))))):s(o)))}),i(this.handleError("eliminar")))}listarPorCreador(t){return this.http.get(`${this.apiUrl}/creador/${t}`).pipe(i(this.handleError("listarPorCreador",[])))}listarEventosPublicos(t=8){let r=new b().set("limite",t.toString());return this.http.get(`${this.apiUrl}/proximos`,{params:r}).pipe(n(e=>{console.log("\u{1F4C5} Eventos pr\xF3ximos p\xFAblicos obtenidos:",e);let o=[];return e&&e.eventos?o=e.eventos:Array.isArray(e)&&(o=e),o.length>0&&this.eventosSubject.next(o),{eventos:o,total:o.length}}),i(e=>(console.error("\u274C Error al obtener eventos p\xFAblicos:",e),this.handleError("listarEventosPublicos",{eventos:[],total:0})(e))))}obtenerEventosPublicos(t=8){let r=new b().set("limite",t.toString());return this.http.get(`${this.apiUrl}/publicos`,{params:r}).pipe(n(e=>console.log("\u{1F4C5} Eventos p\xFAblicos obtenidos:",e)),i(e=>(console.error("\u274C Error al obtener eventos p\xFAblicos:",e),this.handleError("obtenerEventosPublicos",[])(e))))}obtenerDetallePublico(t){return this.http.get(`${this.apiUrl}/${t}`).pipe(n(r=>console.log(`\u2705 Detalle p\xFAblico evento id=${t}:`,r)),i(r=>(console.warn(`\u26A0\uFE0F Error obteniendo detalle p\xFAblico para evento id=${t}:`,r),this.http.get(`${this.apiUrl}/proximos`).pipe(l(e=>{console.log("\u{1F504} Intentando obtener desde endpoint p\xFAblico:",e);let o=[];Array.isArray(e)?o=e:e?.eventos&&(o=e.eventos);let a=o.find($=>$.id===t);if(a)return console.log("\u2705 Evento encontrado en endpoint p\xFAblico:",a),a;throw console.warn(`\u26A0\uFE0F Evento id=${t} no encontrado en endpoint p\xFAblico`),new Error(`Evento ${t} no disponible p\xFAblicamente`)}),i(e=>(console.error(`\u274C Error en todos los m\xE9todos para evento id=${t}:`,e),v(()=>e)))))))}actualizarCacheEvento(t){let r=this.eventosSubject.value,e=r.findIndex(o=>o.id===t.id);e!==-1?r[e]=t:r.push(t),this.eventosSubject.next([...r])}eliminarDelCache(t){let e=this.eventosSubject.value.filter(o=>o.id!==t);this.eventosSubject.next(e)}handleError(t="operation",r){return e=>(console.error(`${t} failed:`,e),v(()=>e))}static \u0275fac=function(r){return new(r||p)(d(m),d(g))};static \u0275prov=h({token:p,factory:p.\u0275fac,providedIn:"root"})};export{f as a};

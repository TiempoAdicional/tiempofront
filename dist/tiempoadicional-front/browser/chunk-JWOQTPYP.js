import{a as b}from"./chunk-W34LC3UO.js";import{a as c,b as u}from"./chunk-MCHRC6DH.js";import{$ as i,H as a,ca as p,ha as d,q as t,u as s}from"./chunk-56OTQPDQ.js";var g=class m{constructor(e){this.http=e}apiUrl=`${b.apiBaseUrl}/api/comentarios`;obtenerInfoComentarios(e){return console.log(`\u{1F504} Obteniendo informaci\xF3n completa de comentarios para noticia ${e}`),this.http.get(`${this.apiUrl}/noticia/${e}/info`).pipe(i(o=>{o.success&&(console.log("\u2705 Informaci\xF3n de comentarios obtenida:",o.data),console.log(`\u{1F4CA} Total: ${o.data.totalComentarios}, Aprobados: ${o.data.comentariosAprobados}, Restantes: ${o.data.restantes}`),o.data&&Array.isArray(o.data.comentarios)&&(console.log("\u{1F4DD} Detalle de comentarios:"),o.data.comentarios.forEach((r,l)=>{console.log(`  [${l}] id: ${r.id}, autor: ${r.autor||r.autorNombre}, mensaje: ${r.mensaje}, fecha: ${r.fecha}, aprobado: ${r.aprobado}`)})))}),a(o=>(console.error("\u274C Error al obtener informaci\xF3n de comentarios:",o),t({success:!1,message:"Error al obtener informaci\xF3n de comentarios",data:{comentarios:[],totalComentarios:0,comentariosAprobados:0,puedeComentary:!1,limite:5,restantes:0}}))))}crearComentario(e){return console.log(`\u{1F504} Creando comentario para noticia ${e.noticiaId}:`,e),this.http.post(`${this.apiUrl}/noticia/${e.noticiaId}`,e).pipe(i(o=>{o.success&&console.log("\u2705 Comentario creado exitosamente:",o.data)}),a(o=>(console.error("\u274C Error al crear comentario:",o),o.error?.codigo==="LIMITE_COMENTARIOS_EXCEDIDO"?t({success:!1,message:"Esta noticia ya tiene el m\xE1ximo de comentarios permitidos (5)",data:null}):t({success:!1,message:o.error?.message||"Error al enviar el comentario. Int\xE9ntalo de nuevo.",data:null}))))}crearComentarioSimple(e,o,r){console.log(`\u{1F504} Creando comentario simple para noticia ${r}`);let l=new c().set("autor",e).set("mensaje",o);return this.http.post(`${this.apiUrl}/noticia/${r}/simple`,null,{params:l}).pipe(i(n=>{n.success&&console.log("\u2705 Comentario simple creado exitosamente:",n.data)}),a(n=>(console.error("\u274C Error al crear comentario simple:",n),t({success:!1,message:n.error?.message||"Error al enviar el comentario simple. Int\xE9ntalo de nuevo.",data:null}))))}obtenerComentariosDeNoticia(e){return console.log(`\u{1F504} Obteniendo comentarios de noticia ${e}`),this.http.get(`${this.apiUrl}/noticia/${e}`).pipe(i(o=>{console.log(`\u2705 Comentarios obtenidos: ${o.length}`)}),a(o=>(console.error("\u274C Error al obtener comentarios:",o),t([]))))}buscarComentarios(e){console.log(`\u{1F504} Buscando comentarios con texto: "${e}"`);let o=new c().set("texto",e);return this.http.get(`${this.apiUrl}/buscar`,{params:o}).pipe(s(r=>r.success?(console.log(`\u2705 Encontrados ${r.data.length} comentarios`),r.data):[]),a(r=>(console.error("\u274C Error al buscar comentarios:",r),t([]))))}obtenerTodosLosComentariosDeNoticia(e){return console.log(`\u{1F504} [ADMIN] Obteniendo todos los comentarios de noticia ${e}`),this.http.get(`${this.apiUrl}/admin/noticia/${e}`).pipe(s(o=>o.success?(console.log(`\u2705 [ADMIN] Comentarios obtenidos: ${o.data.length}`),o.data):[]),a(o=>(console.error("\u274C [ADMIN] Error al obtener comentarios:",o),t([]))))}obtenerComentariosPendientes(){return console.log("\u{1F504} [ADMIN] Obteniendo comentarios pendientes de aprobaci\xF3n"),this.http.get(`${this.apiUrl}/admin/pendientes`).pipe(s(e=>e.success?(console.log(`\u2705 [ADMIN] Comentarios pendientes: ${e.data.length}`),e.data):[]),a(e=>(console.error("\u274C [ADMIN] Error al obtener comentarios pendientes:",e),t([]))))}obtenerComentariosPaginados(e=1,o=20,r=!1){console.log(`\u{1F504} [ADMIN] Obteniendo comentarios paginados (p\xE1gina ${e}, l\xEDmite ${o})`);let l=new c().set("page",e.toString()).set("limit",o.toString()).set("soloAprobados",r.toString());return this.http.get(`${this.apiUrl}/admin`,{params:l}).pipe(i(n=>{n.success&&console.log(`\u2705 [ADMIN] P\xE1gina ${e} obtenida exitosamente`)}),a(n=>(console.error("\u274C [ADMIN] Error al obtener comentarios paginados:",n),t({success:!1,message:"Error al cargar comentarios",data:{content:[],totalElements:0,totalPages:0,number:0}}))))}obtenerEstadisticas(){return console.log("\u{1F504} [ADMIN] Obteniendo estad\xEDsticas de comentarios"),this.http.get(`${this.apiUrl}/admin/estadisticas`).pipe(s(e=>e.success?(console.log("\u2705 [ADMIN] Estad\xEDsticas obtenidas:",e.data),e.data):{total:0,aprobados:0,pendientes:0,rechazados:0}),a(e=>(console.error("\u274C [ADMIN] Error al obtener estad\xEDsticas:",e),t({total:0,aprobados:0,pendientes:0,rechazados:0}))))}aprobarComentario(e){return console.log(`\u{1F504} [ADMIN] Aprobando comentario ${e}`),this.http.patch(`${this.apiUrl}/${e}/aprobar`,{}).pipe(i(o=>{o.success&&console.log("\u2705 [ADMIN] Comentario aprobado exitosamente:",o.data)}),a(o=>(console.error("\u274C [ADMIN] Error al aprobar comentario:",o),t({success:!1,message:"Error al aprobar el comentario. Int\xE9ntalo de nuevo.",data:null}))))}eliminarComentario(e){return console.log(`\u{1F504} [ADMIN] Eliminando comentario ${e}`),this.http.delete(`${this.apiUrl}/${e}`).pipe(i(o=>{o.success&&console.log("\u2705 [ADMIN] Comentario eliminado exitosamente")}),a(o=>(console.error("\u274C [ADMIN] Error al eliminar comentario:",o),t({success:!1,message:"Error al eliminar el comentario. Int\xE9ntalo de nuevo.",data:"Error"}))))}contarComentariosAprobados(e){return this.obtenerComentariosDeNoticia(e).pipe(s(o=>o.length),a(()=>t(0)))}validarComentario(e){let o=[];return(!e.mensaje||e.mensaje.trim().length===0)&&o.push("El contenido del comentario es obligatorio"),e.mensaje&&e.mensaje.length>1e3&&o.push("El comentario no puede superar los 1000 caracteres"),(!e.noticiaId||e.noticiaId<=0)&&o.push("ID de noticia inv\xE1lido"),{valido:o.length===0,errores:o}}validarEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}formatearFecha(e){try{return new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return e}}obtenerMensajeEstado(e){return e.aprobado?"Comentario aprobado y visible":"Comentario pendiente de aprobaci\xF3n"}static \u0275fac=function(o){return new(o||m)(d(u))};static \u0275prov=p({token:m,factory:m.\u0275fac,providedIn:"root"})};export{g as a};
